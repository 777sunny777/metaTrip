<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/metaTrip/build/blog/rss.xml" title="MetaTrip RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/metaTrip/build/blog/atom.xml" title="MetaTrip Atom Feed"><title data-react-helmet="true">react ui library 技术总结 | MetaTrip</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content=" https://777sunny777.github.io/metaTrip//metaTrip/build/blog/ui1"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="react ui library 技术总结 | MetaTrip"><meta data-react-helmet="true" name="description" content="- 这篇blog是对所做的一套react ui library技术总结"><meta data-react-helmet="true" property="og:description" content="- 这篇blog是对所做的一套react ui library技术总结"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2023-01-03T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/777sunny777"><meta data-react-helmet="true" property="article:tag" content="react,react ui library"><link data-react-helmet="true" rel="icon" href="/metaTrip/build/img/metaIcon.png"><link data-react-helmet="true" rel="canonical" href="https://777sunny777.github.io/metaTrip//metaTrip/build/blog/ui1"><link data-react-helmet="true" rel="alternate" href="https://777sunny777.github.io/metaTrip//metaTrip/build/blog/ui1" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://777sunny777.github.io/metaTrip//metaTrip/build/blog/ui1" hreflang="x-default"><link rel="stylesheet" href="/metaTrip/build/assets/css/styles.311e2bb1.css">
<link rel="preload" href="/metaTrip/build/assets/js/runtime~main.4db9aaf6.js" as="script">
<link rel="preload" href="/metaTrip/build/assets/js/main.c54fb828.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/metaTrip/build/"><div class="navbar__logo"><img src="/metaTrip/build/img/metaIcon.png" alt="meta Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/metaTrip/build/img/metaIcon.png" alt="meta Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">MetaTrip</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/metaTrip/build/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/777sunny777/metaTrip" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">MetaTrip with Sheldon</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/metaTrip/build/blog/ui1">react ui library 技术总结</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/npm1">npm 快捷键</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/vscode1">vscode 快捷键</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/react2">useMemo and useCallback, you really know it?</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/media">我做自媒体小视频的一点感触</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/funding-basic5">如何挑选适合投资的指数基金</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/react1">useEffect，you really know it?</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/microFE1">Micro FrontEnd Basic</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/funding-basic4">常见行业指数基金</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/funding-basic3">常见宽基指数基金(二)</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/funding-basic2">常见宽基指数基金(一)</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/storybook-usage2">How to use Storybook 2</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/funding-basic1">资产与指数</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/metaTrip/build/blog/storybook-usage1">How to use Storybook 1</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">react ui library 技术总结</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2023-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2023</time> · <!-- -->22 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/777sunny777" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/777sunny777.png" alt="Sheldon Y Sun"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/777sunny777" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Sheldon Y Sun</span></a></div><small class="avatar__subtitle" itemprop="description">Jser @ Open Source Community</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><ul><li>这篇blog是对所做的一套react ui library技术总结 </li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="1-当前现状">1. 当前现状<a class="hash-link" href="#1-当前现状" title="Direct link to heading">​</a></h2><p>我从2018年5月到A公司，至今超过4年半，将近5年的时间，其中从19年中旬开始做react ui library，到目前差不多也有3年半左右的经验。
这期间经历了两套组件库，第二套基于react 16 hooks开发，至今也有三年左右的时间。这次主要讲的也就是第二套。</p><p>react组件库其实有很多，比较有名的，google的MUI，推特的bootstrap等等，A公司比较大，制作自己的组件库的原因主要是要符合自身的标准，
被公司内部的项目使用，这个标准主要有design，和accessibility两种。还有就是一些功能上的例子，直接用三方的往往需要改造，
并且如果接口不完善，也改造不好，自己做一套才显得更有魄力。</p><p>这个项目实际上是没有自有资金的，所以发展的比较缓慢，目前为止直接45个react常用组件，并且支持5种charts类型，体量上趋近于MUI，
目前服务于14个业务线，这个也是我们比较好的战绩体现。使用组件库可以大幅的减少项目ui的开发时间，这个大家都有认识，这个效率大概是90%。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="2-框架设计">2. 框架设计<a class="hash-link" href="#2-框架设计" title="Direct link to heading">​</a></h2><p>抱歉我还不能图文并茂的展示内部项目，这里我只能文字性的描述：</p><p>1.项目的表现层主要用的到技术是： </p><p>react(16/17 hooks之后)，styled-components, styled system(这两块主要用来写css in js)，
style dictionary用来管理theme token(它主要是可以将json格式转化成很多文件格式，用以引用)，storybook用来展示case demo，
docusaurus用来写website 文档，typescript辅助管理接口，react testing library+jest+jest-styled-components 来做UT，
robot framework+Selenium Library来做auto testing，D3 V7来做charts</p><p>2.中间层主要用到的技术是：</p><p>node js环境，yarn+lerna来管理monoRepo</p><p>3.代码层主要用到的技术是：</p><p>GitHub 存放管理代码，nexus来存放发布ui包</p><p><strong> 下面有会重点总结如下几个关键技术：</strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-1-muti-repo-and-monorepo">2-1. Muti-repo and Monorepo<a class="hash-link" href="#2-1-muti-repo-and-monorepo" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>前面说过我做过两套react组件库，第一套使用的是Muti-repo, 第二套使用的是Monorepo
这两种repo的开发管理模式或者优缺点是什么呢？我根据实际经验和大家聊一下。</p></div></div><p>首先提前需要说到的两点是：</p><p>1.这两种模式没有优劣，需要根据项目特点，开发需求来定
2.某种模式下的缺点也是可以尽量弥补的，不是完全解决不了的，不过你需要额外的efforts</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-1-1-repo-management">2-1-1. repo management<a class="hash-link" href="#2-1-1-repo-management" title="Direct link to heading">​</a></h4><p>对于组件库而言，日常的库管理包括：branch管理，github issue，release changelog，
readme文件，monorepo相比muti 很容易理解会更加的合适和方便，history search这块应该就见仁见智了</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-1-2-quality-control">2-1-2. quality control<a class="hash-link" href="#2-1-2-quality-control" title="Direct link to heading">​</a></h4><p>质量把控方面，cicd/pipeline，这个设置上mono更方便; storybook cases设置上也更容易是一个整体。
muti-repo一般情况下是分开的，一个repo或者一个组件是单独的storybook cases，
当然你也可以设置一个大壳子，来整体展示组件，但是就需要额外的开发成本。</p><p>这块你可能会问，问什么要把storybook cases 放到一块去好一些？ 组件库是一个整体，不是相互独立的多个组件的集合。
组件内部的联系远比你想象的多，放在一起可以整体把握impacts，无论是manual check， UT还是auto testing，还是site部署都容易的多。</p><p>PR review 也是见仁见智，mono review的成本更大，一个PR 包含信息更多
muti review PR想多简单一些，但是组件间关联的潜在问题可能无法及时暴漏
还有公共方法的修改要小心，UT也无法第一时间覆盖到。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-1-3-release-control">2-1-3. release control<a class="hash-link" href="#2-1-3-release-control" title="Direct link to heading">​</a></h4><p>muti release更加灵活， package的引用也更加灵活
mono ui包的组件是同时来release的，影响范围大， release风险相对较高，失败的可能性大</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-1-4-version-control">2-1-4. version control<a class="hash-link" href="#2-1-4-version-control" title="Direct link to heading">​</a></h4><p>muti 组件间版本依赖问题，嵌套问题，同步问题需要很好的策略来解决，
npm install需要花费更多时间 </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-2-npm-and-yarn">2-2. npm and yarn<a class="hash-link" href="#2-2-npm-and-yarn" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>第二套使用的yarn来安装管理packages</p><p>参考：<a href="https://www.knowledgehut.com/blog/web-development/yarn-vs-npm" target="_blank" rel="noopener noreferrer">https://www.knowledgehut.com/blog/web-development/yarn-vs-npm</a></p></div></div><p>首先nodejs是前端开发都会使用的到工具，他是基于V8引擎开发的js runtime ENV。</p><p><strong> NPM：node package manager </strong>，node包管理工具（install，update，manage， remove）这几项。
他是node的默认工具，安装node的时候就会预安装npm</p><p><strong> Yarn: Yet Another Resource Navigator</strong>, 最早是16年由Facebook开发的另一套nodejs 包管理工具。因为他不是预安装的，所以需要通过npm先进行安装</p><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">npm install yarn </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">g</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>简单来说yarn促进了npm的发展，比如说yarn是第一个带来版本锁定功能的工具，后面npm也实现了这个功能，
目前来看两者相比较，yarn的安装速度也更快一些。</p><p>先说一些共同点，两者都可以生成lock文件；都支持offline的时候install from cache；都支持workspaces。monorepo的开发模式（npm v7）
<a href="https://docs.npmjs.com/cli/v7/using-npm/workspaces" target="_blank" rel="noopener noreferrer">https://docs.npmjs.com/cli/v7/using-npm/workspaces</a>
都提供了npx，dlx来执行依赖命令，这个可以是还没有安装的依赖。</p><p><strong> NPX：Node package Execute</strong>， （npm v5.2, 有了直接执行，没有会先下载）</p><p>然后再说下为啥yarn会比npm快一些：主要有两点，第一个是parallel installation.
<a href="https://blog.csdn.net/yuqing1008/article/details/107328920/" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yuqing1008/article/details/107328920/</a>
这个设计到yarn install包的有限队列规则与npm不同，有兴趣大家可以去看文档</p><p>第二个就是plug&#x27;n&#x27;play feature，即插即用功能，yarn v2 才有的
简单来说，一般npm 会先解析版本，下载到缓存区，解压，再拷贝到项目的node_modules 路径中去，
如果同一个包版本不同，会嵌套进去再拷贝。</p><p>查找的时候是逆着来的，子集里面没有再到root里面的node_modules里查找，这样就有大量的I/O操作</p><p>yarn的这个功能，并不会直接把依赖考到项目的node_modules 路径中去，而是在pnp.js 文件中记录下来缓存中具体位置
这样就避免了大量的I/O操作，同时也不会有node_modules目录生成</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-3-lerna-management">2-3. lerna management<a class="hash-link" href="#2-3-lerna-management" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>lerna是一个管理js monorepo的工具</p></div></div><p>简单说几个常用命令：</p><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lerna init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//1.安装lerna到devdenpendency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//2.生成一个lerna.json的config 文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这里面注意 </span><span class="token string" style="color:#e3116c">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;independent&quot;</span><span class="token plain"> 可以各个包发布不同版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//3. 生成gitignore 如果没有的话</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">2.</span><span class="token plain"> lerna bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//1. npm install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//2. Symlink</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">3.</span><span class="token plain"> lerna changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看</span><span class="token keyword" style="color:#00009f">package</span><span class="token plain">的变化名单</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">4.</span><span class="token plain"> lerna version </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">no</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lerna</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lerna</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tree</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">commands</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">version#readme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">发布之前更新版本的，可以选择，并且把依赖中的版本也都一起更新了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">5.</span><span class="token plain"> lerna publish </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">no</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lerna</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lerna</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tree</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">commands</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">publish#readme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">发布</span><span class="token keyword" style="color:#00009f">package</span><span class="token plain">，包含更新版本选择</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-4-styled-components-and-styled-system">2-4. styled components and styled system<a class="hash-link" href="#2-4-styled-components-and-styled-system" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>styled components css in js的框架</p><p>styled system 是快速构建UI的一个辅助工具</p></div></div><p>这里面主要说一下styled components and styled system 使用中的一些问题</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-4-1-insertrule">2-4-1. insertRule<a class="hash-link" href="#2-4-1-insertrule" title="Direct link to heading">​</a></h4><p>styled components有一个insertRule 的后面
默认的时候，development mode是关闭insertRule, 这样你就可以在element的style中看到css inline styles
在production mode 会打开insertRule， 这样你就看不到了，但是会加快页面加载速度</p><p>这个后面是在webpack中配置一个process ENV</p><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// force the speed false for speedym true for no speedy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-property property" style="color:#36acaa">&#x27;process.env.REACT_APP_SC_DISABLE_SPEEDY&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>我们发现build-storybook的时候找不到inline styles，本地server的时候可以看到，为什么呢？
其实就是因为storybook是基于webpack的，build-storybook就是production mode了，所以就隐藏了。</p><img src="/metaTrip/build/img/blog/b1.png" alt="" style="width:100%"><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-4-2-inherits-styles">2-4-2. inherits styles<a class="hash-link" href="#2-4-2-inherits-styles" title="Direct link to heading">​</a></h4><p>styled components在继承属性这有一个坑，就是“as” prop会改变rendering target，
比如 styled(Comp)的target 是Comp， styled(div)或者styled.div的target是div，
如果在styled(Comp)上用as，那么就改变了target到div，也就失去了Comp中的样式继承。</p><p>官方文档推荐用forwardedAs 来替代就可以了
<a href="https://styled-components.com/docs/api#forwardedas-prop" target="_blank" rel="noopener noreferrer">https://styled-components.com/docs/api#forwardedas-prop</a></p><img src="/metaTrip/build/img/blog/b2.png" alt="" style="width:100%"><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-4-3-priority-styles">2-4-3. priority styles<a class="hash-link" href="#2-4-3-priority-styles" title="Direct link to heading">​</a></h4><img src="/metaTrip/build/img/blog/b3.png" alt="" style="width:100%"><p>下面的样式优先级应该是：</p><p>orange &gt; chocolate &gt; pink &gt; darkgreen &gt; yellow &gt; red &gt; blue</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-4-4-flicker">2-4-4. flicker<a class="hash-link" href="#2-4-4-flicker" title="Direct link to heading">​</a></h4><p>我在做组件库的过程中，在有些组件，比如tooltip，dropdown，datepicker的时候，
发现页面第一次加载的时候，打开menu，页面中文字会发生抖动现象，
只有第一次加载后会发生，然后再反复打开关闭menu，就不会发生了。</p><p>先说解决思路，排除法找到影响的代码，这些代码往往是menu中的具有styled components样式的组件
如果把这个组件提前再页面隐藏起来，就没有问题了</p><p>可能的原因就是styled components 这种css in js的方式，在组件没有render的时候，对应的inline style
也没有生成，当打开menu的时候，css inline style生成了，并且插入到了style中，这就产生了页面的重绘，
如果提前将样式加载进去，就不会产生页面重绘了，也就不会抖动了</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-5-rollup">2-5. Rollup<a class="hash-link" href="#2-5-rollup" title="Direct link to heading">​</a></h3><p>因为大家对webpack都比较了解，这里面简单说一下rollup。
<a href="https://medium.com/@PepsRyuu/why-i-use-rollup-and-not-webpack-e3ab163f4fd3" target="_blank" rel="noopener noreferrer">https://medium.com/@PepsRyuu/why-i-use-rollup-and-not-webpack-e3ab163f4fd3</a></p><p>Rollup for libraries, webpack for apps.
这个也不是绝对的，关键还是看需求。</p><p>如果项目需要代码拆分，或者有很多静态资源需要处理
再或者你构建的项目需要引入很多CommonJS模块的依赖，那就应该选择webpack</p><p>如果你的代码是基于ES模块的。而且你写的代码希望能够被其他项目直接使用
那么rollup可能更适合</p><p>简单来看下rollup配置</p><p>1.input， output.file和output.format都是必传的</p><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// rollup 也支持配置多个文件入口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">input</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./foo.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">bar</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./bar.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">dir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dist&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">format</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cjs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2.插件的配置比较简单，都是在plugin统一配置的</p><p>rollup默认只能加载es6的模块，所以需要commonjs模块，
我们引用node_mode中的第三方模块，需要用到rollup-plugin-mode-reslove来解析</p><p>3.rollup本身不支持启动开发服务器，需要通过第三方插件rollup-plugin-server来启动一个静态服务器</p><div class="codeBlockContainer_J+bg language-jsx theme-code-block"><div class="codeBlockContent_csEI jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> serve </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rollup-plugin-serve&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">input</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./main.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output： </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dist/bundle.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">format</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iife&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dist&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 本质上是一个静态资源服务器，因此不支持模块热更新</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>4.Tree shaking</p><p>由于rollup本身支持ES6模块化规范，因此不需要额外配置即可进行tree shaking
不过如果你需要external依赖，需要注意子集module不会被filter掉，需要自定义</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-6-style-dictionary">2-6. style dictionary<a class="hash-link" href="#2-6-style-dictionary" title="Direct link to heading">​</a></h3><p>style dictionary 是一个theme 管理工具
他有丰富的接口，可以将json转化成各种项目需要的文档，
IOS, Android, css, js, html, sass，less 任何你需要的格式
这其实就为theme tokens的跨平台应用提供了可能。
<a href="https://amzn.github.io/style-dictionary/#/" target="_blank" rel="noopener noreferrer">https://amzn.github.io/style-dictionary/#/</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="3-design-but-not-only-design">3. Design but not Only Design<a class="hash-link" href="#3-design-but-not-only-design" title="Direct link to heading">​</a></h2><p>A公司有自己的一套design的标准，里面大概分两个部分，一个是foundation的部分
主要包括layout，RS(就是空间变化，padding，margin)，TS(字体变化，包括size，line-height, weight, letter-space),
breakpoints, color, icon等等。另一个部分就是各个组件的详细设计，但是设计单位都是要按照foundation进行的。</p><p>整体是一个theme的话，我们就可以把theme拆分成几个tokens。</p><p>1.Design tokens：就是design的基础定义，字体，颜色，空间这些，他们被Seman tokens使用</p><p>2.Semantic tokens：就是实际应用的语义，比如cta（default, hover, pressed, disabled），rag( error, warning, success, info)等等</p><p>3.UI tokens：组件用到的token， button, radio等等</p><img src="/metaTrip/build/img/blog/b4.png" alt="" style="width:100%"><p>而Design tokens 和 Semantic tokens是可以用style dictionary来进行管理的，这样就实现了跨框架，跨平台的应用
实际上我们也实现了一个实际的例子，web/ios/Android 公用一套theme toolkit</p><p>这样设计，还带来了另一个好玩的东西，就是换肤，
你可以想象，组件逻辑不变，ui token不变，只是Semantic tokens 被不同的design token复写，那么就可以实现一套组件库，不同皮肤功能，
实际上这个poc也是完成了的。</p><p>所以整体上通过style dictionary管理theme，我们可以横向把foudation当作共同资源，跨框架和跨平台使用，纵向上通过换肤，扩展组件库应用范围</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="4-解耦和重用">4. 解耦和重用<a class="hash-link" href="#4-解耦和重用" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-ui组件开发的一些特点">4-1. UI组件开发的一些特点<a class="hash-link" href="#4-1-ui组件开发的一些特点" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-1-不要加入业务逻辑">4-1-1. 不要加入业务逻辑<a class="hash-link" href="#4-1-1-不要加入业务逻辑" title="Direct link to heading">​</a></h4><p>这个有的时候并不好分辨，尤其是对于新加的props，比如输入框的验证逻辑，需不需写在组件内部，
比如nls，那些是组件内部控制的，那些是业务逻辑。立场不同观点也不尽相同。
但是我们开发组件需要做个决定，而且标准前后要保持一致</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-2-组件接口要具有普遍性">4-1-2. 组件接口要具有普遍性<a class="hash-link" href="#4-1-2-组件接口要具有普遍性" title="Direct link to heading">​</a></h4><p>组件接口要适用大部分项目，要尽量简化。
不增加无意义的接口，比如我们之前iconlink 这个组件有mutiline这个接口，
就是link中内容在一行和两行中icon 样式不一样，所以先想当然的用mutiline来进行区分。</p><p>但是这个接口有意义么？没有意义，因为实际的项目中考虑到响应式布局，以及nls因素，单行和双行是不确定的
所以这个方法是行不通的</p><p>还有个例子，比如notification中title 有两种样式， 我们可以定义两个props, 比如title 用font h1，subtitle 用h2
但是这就有个问题，首先把title和subtitle font设定死，如果以后再扩展呢？title3？ title4？
另外我们考虑到title本身除了传string外，还可以是react.node, 所以title接口本身就可以实现title h1和subtitle h2的设计，
所以我们开始就不需要增加接口，只需要提供case，保持组件内部接口足够灵活和简单。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-3-高标准">4-1-3. 高标准<a class="hash-link" href="#4-1-3-高标准" title="Direct link to heading">​</a></h4><p>这里面主要说的就是两个标准，design和accessibility</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-4-dont-cry-over-spilt-milk">4-1-4. Don&#x27;t cry over spilt milk<a class="hash-link" href="#4-1-4-dont-cry-over-spilt-milk" title="Direct link to heading">​</a></h4><p>如果写了不好的代码，尤其是接口，就需要继续维护，不能轻易删除
删除接口就会面临breaking changes，能不能删掉有时候不由组件开发者来决定。还要考虑到项目的影响。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-1-5-unknown-impacts">4-1-5. unknown impacts<a class="hash-link" href="#4-1-5-unknown-impacts" title="Direct link to heading">​</a></h4><p>组件的发布，在做好自身质量把控的情况下，还有很多影响是未知的。
你不知道都有谁在用？你也不知道用户怎么用？
有时候发布上去，用户更新出了问题才知道，或者除了问题用户也不知道。比如很久之前的功能。</p><p>同时impacts也取决与用户更新版本的方式和频率。对于组件库来讲，最好的方式当然是，及时更新最新版本，并且严格使用cases中的标准写法。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-解耦是为了提升复用率">4-2. 解耦是为了提升复用率<a class="hash-link" href="#4-2-解耦是为了提升复用率" title="Direct link to heading">​</a></h3><p>组件库内部代码不断演变，以及重构的方向，实际上就是不断解耦以及重用的过程。
整个组件库，或者说组件生态，会划分为五个级别。</p><p>从小到大分别是：逻辑，单个组件，视觉和行为，主题和组件库，以及依赖。</p><img src="/metaTrip/build/img/blog/b5.png" alt="" style="width:100%"><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-1逻辑上讲">4-2-1.逻辑上讲<a class="hash-link" href="#4-2-1逻辑上讲" title="Direct link to heading">​</a></h4><p>作为developer，大家自然会去减少代码重复，提取公共变量，公共方法，工具方法等等</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-2组件层面">4-2-2.组件层面，<a class="hash-link" href="#4-2-2组件层面" title="Direct link to heading">​</a></h4><p>react本身的特点是component-based, compose components to build the complex UIs. 所以是一种搭积木的方式，
由简单到复杂的去进行开发。组件库内部的实现由两种，一种是在基础组件上构建新组件，比如dropdown，datepicker。有点像之前HOC的方式。
还有一种就是基础组件之间的组合，比如pagenation，iconbutton等等</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-3视觉和行为分离">4-2-3.视觉和行为分离<a class="hash-link" href="#4-2-3视觉和行为分离" title="Direct link to heading">​</a></h4><p>一个例子，button和link button，如果用composed components 来做，样式上要进行覆盖，代码并不友好。
划分不干净，后期维护impacts要考虑到button和link button 两个组件范围。实际中，UI视觉是可以有很多变化的，但是button行为，
以及a11y是要遵循一致性的，也就是native的特点。如果我们这样考虑将两者分类就会很干净。</p><p>另外也可以反过来，同样的视觉效果，但是行为是完全不一样的，比如pills。所以视觉和行为分离会带来很多好处，对于用户也更加灵活。
我们导出这些行为的hooks，用户可以直接使用，自定义UI。 类似与table，tooltip 都是如此，比如table，我们专注与UI，用户可以选择或者不用react-table
都没有问题</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-4主题和组件库分离">4-2-4.主题和组件库分离<a class="hash-link" href="#4-2-4主题和组件库分离" title="Direct link to heading">​</a></h4><p>这个在前面第三点(Design but not Only Design)有说过，theme是可以独立出来作为共享资源存在的，
而theme和组件库解绑，也有利于组件库本身的换肤，增大适用范围</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-2-5依赖">4-2-5.依赖<a class="hash-link" href="#4-2-5依赖" title="Direct link to heading">​</a></h4><p>组件库和chart库相互独立，包括开发，发布，下载相互没有依赖，
增大彼此的发展空间，更大的方向上，目前的组件库受到react版本限制，
组件库本身的用户有react16，17，还有18。但是我们如何支持18，这个问题会一致存在
我们如何打破这个限制也是下一步的方向</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/metaTrip/build/blog/tags/react">react</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/metaTrip/build/blog/tags/react-ui-library">react ui library</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/metaTrip/build/blog/npm1"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">npm 快捷键<!-- --> »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-当前现状" class="table-of-contents__link toc-highlight">1. 当前现状</a></li><li><a href="#2-框架设计" class="table-of-contents__link toc-highlight">2. 框架设计</a><ul><li><a href="#2-1-muti-repo-and-monorepo" class="table-of-contents__link toc-highlight">2-1. Muti-repo and Monorepo</a></li><li><a href="#2-2-npm-and-yarn" class="table-of-contents__link toc-highlight">2-2. npm and yarn</a></li><li><a href="#2-3-lerna-management" class="table-of-contents__link toc-highlight">2-3. lerna management</a></li><li><a href="#2-4-styled-components-and-styled-system" class="table-of-contents__link toc-highlight">2-4. styled components and styled system</a></li><li><a href="#2-5-rollup" class="table-of-contents__link toc-highlight">2-5. Rollup</a></li><li><a href="#2-6-style-dictionary" class="table-of-contents__link toc-highlight">2-6. style dictionary</a></li></ul></li><li><a href="#3-design-but-not-only-design" class="table-of-contents__link toc-highlight">3. Design but not Only Design</a></li><li><a href="#4-解耦和重用" class="table-of-contents__link toc-highlight">4. 解耦和重用</a><ul><li><a href="#4-1-ui组件开发的一些特点" class="table-of-contents__link toc-highlight">4-1. UI组件开发的一些特点</a></li><li><a href="#4-2-解耦是为了提升复用率" class="table-of-contents__link toc-highlight">4-2. 解耦是为了提升复用率</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/metaTrip/build/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/metaTrip/build/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/metaTrip/build/assets/js/runtime~main.4db9aaf6.js"></script>
<script src="/metaTrip/build/assets/js/main.c54fb828.js"></script>
</body>
</html>