---
slug: storybook-usage2
title: How to use Storybook 2
authors: [sheldon]
tags: [storybook, react]
---

import react from 'react';

:::tip
- è¿™ç¯‡blogæ˜¯storybookçš„å…¥é—¨æ•™ç¨‹å¹¶ä¸”åŒ…å«äº†æˆ‘ä½¿ç”¨storybook 3å¹´å¤šçš„ä¸€äº›ä½“éªŒ 
- åªé’ˆå¯¹Reacté¡¹ç›®
- è¿›ä¸€æ­¥å­¦ä¹ ï¼Œè¯·è®¿é—®[Storybookå®˜ç½‘](https://storybook.js.org/)
:::

[Storybook](https://storybook.js.org/) is an open source tool for building UI components and pages in isolation. It streamlines UI development, testing, and documentation.

ä»Storybookçš„å®˜æ–¹æè¿°æ¥çœ‹ï¼Œä»–æ˜¯ç”¨äºå¿«é€Ÿæ„å»ºUI demoçš„å·¥å…·ï¼Œå¯ä»¥å¸®ç”¨æˆ·å¿«é€Ÿæ„å»ºé¡µé¢ï¼›å¹¶ä¸”æœ‰å¾ˆå¥½çš„è¯­æ³•åŠŸèƒ½ï¼Œè½»æ¾ä¹¦å†™demoï¼›è¿˜æœ‰å¾ˆå¥½çš„è¾…åŠ©æ’ä»¶ï¼Œ
æ¯”å¦‚demoçš„æ–‡æ¡£è¾…åŠ©ï¼Œå‚æ•°è¾…åŠ©ï¼Œè¿˜æœ‰accessibilityè¾…åŠ©æµ‹è¯•ç­‰ç­‰ã€‚è¿™ä¸€åˆ‡å‡ ä¹ä¿ƒä½¿å®ƒæˆä¸ºäº†é¡¹ç›®demoçš„æœ€å¥½é€‰æ‹©ã€‚å› ä¸ºæˆ‘çš„é¡¹ç›®æ¶‰åŠåˆ°ç»„ä»¶åº“çš„å¼€å‘ï¼Œ
æ‰€ä»¥storybookå°±æ›´æ˜¾å¾—åˆé€‚å’Œé‡è¦ã€‚

:::note
- version: v6.4.9(Currently) and [Latest](https://github.com/storybookjs/storybook/releases)
:::

Storybook ä»£ç åº“æ›´æ–°å¾ˆæ´»è·ƒï¼Œå‡ ä¹ä¸€å¹´ä¸€æ¬¡majorç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ€»ä¼šå¸¦æ¥äº›æ–°çš„åŠŸèƒ½ï¼Œè¿™ç¯‡blogæˆ‘ä»¬é‚£ç›®å‰æœ€æ–°ç‰ˆæœ¬v6.4.9 ä¸ºä¾‹è¿›è¡Œè¯´æ˜

<!--truncate-->

## 4. Configure

Storybook is configured via a folder called .storybook, which contains various configuration files.

Storybooké…ç½®æ–‡ä»¶ä¸€èˆ¬æ˜¯æ”¾åœ¨.storybookçš„æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œé€šè¿‡-cä¹Ÿå¯ä»¥è¿›è¡Œè·¯å¾„é…ç½®ã€‚ä¸»è¦åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼šmain.js preview.js and manager.js
[Detials](https://storybook.js.org/docs/react/configure/overview)

### 4-1. main.js

The main configuration file is main.js.

:::note
- This file controls the Storybook server's behavior, so you must restart Storybookâ€™s process when you change it.
:::

The main.js configuration file is a preset and, as such, has a powerful interface, but the key fields within it are:

- stories: ä¸»è¦æ˜¯é…ç½®storie casesçš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯æ–‡ä»¶åä¸­å¸¦æœ‰ stories çš„æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ï¼Œæ–‡ä»¶åè§„åˆ™ï¼Œæ–‡ä»¶åç¼€éƒ½æ˜¯å¯é…ç½®çš„ã€‚
- addons - é…ç½®ä¸€ä¸‹é¡µé¢ä¸­éœ€è¦ç”¨åˆ°çš„addons.
- webpackFinal - è‡ªå®šä¹‰çš„ webpack configuration.
- babel - è‡ªå®šä¹‰çš„ babel configuration.

```jsx
// .storybook/main.js

module.exports = {
  stories: ['../packages/MyStories'],
  addons: ['@storybook/addon-essentials'],
  webpackFinal: async (config, { configType }) => {
    config.module.rules.push({
      test: /\.scss$/,
      use: ['style-loader', 'css-loader', 'sass-loader'],
      include: path.resolve(__dirname, '../'),
    });

    return config;
  },
    babel: async (options) => ({
    ...options,
    // any extra options you want to set
  })
};

```

#### On-demand story loadingï¼š

æŒ‰éœ€åŠ è½½storiesï¼Œè¿›è¡Œæ€§èƒ½æå‡ï¼Œ**Starting with Storybook 6.4**, you can optimize your story loading by enabling the storyStoreV7 feature flag in your configuration as follows:

```jsx
// .storybook/main.js

module.exports = {
  stories: [],
  addons: ['@storybook/addon-essentials'],
  features: {
    storyStoreV7: true,
  },
};

```

### 4-2. preview.js

To control the way stories are rendered and add global decorators and parameters

- This is loaded in the Canvas tab
- Use preview.js for global code that applies to all stories.

The preview.js file can be an ES module and export the following keys:

- decoratorsï¼šåŒ…å«é¡µé¢ç»“æ„å’Œå…¨å±€æ ·å¼ï¼Œéƒ½å¯ä»¥åœ¨decoratorsä¸­å®šä¹‰
- parametersï¼šä¸€èˆ¬å¯ä»¥é…ç½®å…¨å±€çš„docså’Œactionï¼Œbackground
- globalTypes: 

```jsx
// .storybook/preview.js

// createGlobalStyle from styled-component
import GlobalStyles from './GlobalStyles';

export const decorators = [
  (Story) => (
    <GlobalStyles />
    <div style={{ margin: '3em' }}>
      <Story />
    </div>
  ),
];

export const parameters = {
  backgrounds: {
    values: [
      { name: 'red', value: '#f00' },
      { name: 'green', value: '#0f0' },
    ],
  },
};

export const globalTypes = {
  theme: {
    name: 'Theme',
    description: 'Global theme for components',
    defaultValue: 'light',
    toolbar: {
      icon: 'circlehollow',
      // Array of plain string values or MenuItem shape (see below)
      items: ['light', 'dark'],
      // Property that specifies if the name of the item will be displayed
      showName: true,
    },
  },
};

```

### 4-3. manager.js

To control the layout of Storybookâ€™s UI you can use addons.setConfig in your .storybook/manager.js:

```jsx
// .storybook/manager.js

import { addons } from '@storybook/addons';

addons.setConfig({
  isFullscreen: false,
  showNav: true,
  showPanel: true,
  panelPosition: 'bottom',
  enableShortcuts: true,
  isToolshown: true,
  theme: undefined,
  selectedPanel: undefined,
  initialActive: 'sidebar',
  sidebar: {
    showRoots: false,
    collapsedRoots: ['other'],
  },
  toolbar: {
    title: { hidden: false, },
    zoom: { hidden: false, },
    eject: { hidden: false, },
    copy: { hidden: false, },
    fullscreen: { hidden: false, },
  },
});

```

## 5. Essential addons and Addons

Storybookåœ¨å‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¸æ”¶ä¸€äº›å¸¸ç”¨çš„addonï¼Œä½œä¸ºæ¡†æ¶é¢„åˆ¶çš„addonï¼Œè¿™ä¸ªå°±æ˜¯Essential addons and Addonsçš„åŒºåˆ«ã€‚ 
ä½ç‰ˆæœ¬çš„control å®é™…ä¸Šæ˜¯ä¸€ä¸ª@storybook/addon-knobsï¼Œåœ¨V6ç‰ˆæœ¬å¯ä»¥å†…ç½®ç”Ÿæˆäº†ã€‚ä½†æ˜¯è¿™ä¸ªæ’ä»¶æœ¬èº«ç›®å‰æ˜¯å‘ä¸‹å…¼å®¹çš„

### 5-1. Essential addons

If you're upgrading from a previous Storybook version, you'll need to run the following command in your terminal:

```jsx
#With npm
npm install -D @storybook/addon-essentials

#With yarn
yarn add -D @storybook/addon-essentials

// .storybook/main.js

module.exports = {
  addons: ['@storybook/addon-essentials'],
};

```

There are many third-party addons as well as â€œofficialâ€ addons developed by the Storybook core team.ã€
[Detials](https://storybook.js.org/docs/react/essentials/introduction)

- Docs
- Controls
- Actions
- Viewport
- Backgrounds
- Toolbars & globals
- Measure
- Outline


### 5-2. Install 3rd party addons

Storybook has [hundreds of reusable addons](https://storybook.js.org/addons) that are packaged as NPM modules.

#### Using addons
[Detials](https://storybook.js.org/docs/react/addons/install-addons#using-addons)

```jsx

yarn add -D @storybook/addon-a11y

// .storybook/main.js

module.exports = {
  stories: [],
  addons: [
    // Other Storybook addons
    '@storybook/addon-a11y', //ğŸ‘ˆ The addon registered here
  ],
};

```

<img src="https://storybook.js.org/5c457fbc275d0c3e2a37aae388a6019f/storybook-addon-installed-registered.png" alt="Storybook addon" style={{width: '100%'}}/>


### 5-3. è‡ªå®šä¹‰addons

Now letâ€™s add a panel to Storybook. Inside the src directory, create a new file called register.js and add the following:
[Detials](https://storybook.js.org/docs/react/addons/writing-addons#add-a-panel)

```jsx
// /my-addon/src/register.js

import React from 'react';

import { addons, types } from '@storybook/addons';

import { AddonPanel } from '@storybook/components';

const ADDON_ID = 'myaddon';
const PANEL_ID = `${ADDON_ID}/panel`;

// give a unique name for the panel
const MyPanel = () => <div>MyAddon</div>;

addons.register(ADDON_ID, (api) => {
  addons.add(PANEL_ID, {
    type: types.PANEL,
    title: 'My Addon',
    render: ({ active, key }) => (
      <AddonPanel active={active} key={key}>
        <MyPanel />
      </AddonPanel>
    ),
  });
});
```

:::note
- register éœ€è¦åœ¨main.jsè¿›è¡Œæ³¨å†Œï¼ˆWhen you register a Storybook addon, it will look for either register.js or preset.js as the entry points.ï¼‰
:::

<img src="https://storybook.js.org/8a84ad965e96ef91ab0feb62f03b48b9/addon-initial-state.png" alt="Storybook addon" style={{width: '100%'}}/>


## 6. CLI options

Storybook comes with two CLI utilities: start-storybook and build-storybook.
[Detials](https://storybook.js.org/docs/react/api/cli-options)
